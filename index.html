<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>ความสัมพันธ์ระหว่างปริมาณน้ำฝนและเวลาเดินทาง</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body class="container is-max-desktop p-4">
    <div class="card">
        <header class="card-header">
            <p class="card-header-title">
                ความสัมพันธ์ระหว่างปริมาณน้ำฝนและเวลาเดินทาง
            </p>
        </header>
        <div class="card-content">
            <form id="predictionForm" class="mb-4">
                <div class="field">
                    <label class="label">ระยะทาง (กม.) - ค่าคงที่</label>
                    <div class="control">
                        <input type="number" class="input" id="distanceInput" value="10" step="0.1" required>
                    </div>
                </div>
                <div class="field">
                    <label class="label">การเดินทางด้วยพาหนะส่วนตัว - ค่าคงที่</label>
                    <div class="control">
                        <label class="radio">
                            <input type="radio" name="privateVehicle" value="0" checked required>
                            สาธารณะ
                        </label>
                        <label class="radio">
                            <input type="radio" name="privateVehicle" value="1" required>
                            ส่วนตัว
                        </label>
                    </div>
                </div>
            </form>

            <div id="predictionChart"></div>
        </div>
    </div>

    <script>
        const RMSE = 10.19;
        const coefficients = {
            intercept: 16.130,
            X1: 0.222,   // ปริมาณน้ำฝน
            X2: 0.695,   // ระยะทาง
            X3: -7.005   // พาหนะส่วนตัว
        };

        function calculateTravelTime(X1, X2, X3) {
            return coefficients.intercept + 
                   (coefficients.X1 * X1) + 
                   (coefficients.X2 * X2) + 
                   (coefficients.X3 * X3);
        }

        function generatePredictionData(distance, privateVehicle) {
            const rainfallValues = Array.from({length: 201}, (_, i) => i);
            const travelTimes = rainfallValues.map(rainfall => 
                calculateTravelTime(rainfall, distance, privateVehicle)
            );
            
            const upperBand = travelTimes.map(time => time + RMSE);
            const lowerBand = travelTimes.map(time => time - RMSE);

            return {
                rainfallValues,
                travelTimes,
                upperBand,
                lowerBand
            };
        }

        function updateChart() {
            const distance = parseFloat(document.getElementById('distanceInput').value);
            const privateVehicle = document.querySelector('input[name="privateVehicle"]:checked').value;
            
            const { rainfallValues, travelTimes, upperBand, lowerBand } = generatePredictionData(distance, privateVehicle);

            const trace1 = {
                x: rainfallValues,
                y: upperBand,
                type: 'scatter',
                mode: 'lines',
                line: { color: 'transparent' },
                name: 'Upper Bound'
            };

            const trace2 = {
                x: rainfallValues,
                y: lowerBand,
                type: 'scatter',
                mode: 'lines',
                fill: 'tonexty',
                fillcolor: 'rgba(0,100,200,0.2)',
                line: { color: 'transparent' },
                name: 'Lower Bound'
            };

            const trace3 = {
                x: rainfallValues,
                y: travelTimes,
                type: 'scatter',
                mode: 'line',
                line: { color: 'blue' },
                name: 'เวลาเดินทาง'
            };

            const layout = {
                title: 'อิทธิพลของปริมาณน้ำฝนต่อเวลาเดินทาง',
                xaxis: { 
                    title: 'ปริมาณน้ำฝน (มม.)', 
                    range: [0, 200] 
                },
                yaxis: { 
                    title: 'เวลาเดินทาง (นาที)' 
                },
                showlegend: true
            };

            Plotly.newPlot('predictionChart', [trace1, trace2, trace3], layout);
        }

        // Event listeners
        document.getElementById('distanceInput').addEventListener('change', updateChart);
        document.getElementsByName('privateVehicle').forEach(radio => 
            radio.addEventListener('change', updateChart)
        );

        // Initial chart render
        updateChart();
    </script>
</body>
</html>
